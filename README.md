# Менеджер секретов GophKeeper

Дипломный проект второй половины курса «Продвинутый Go-разработчик».

#### Описание задачи:
- [Specification](docs/SPECIFICATION.md)
#### Поднятие системы локально с помощью docker compose :
- [Docker](docs/DOCKER.md)

## Предназначение
Менеджер представляет из себя клиент-серверную систему, для хранения секретных данных пользователя.
#### Типы секретных данных (секретов):
* Пара логин/пароль
* Файлы
* Данные банковских карт
* Произвольный текстовые данные

## Принципы работы системы

### Клиент-серверное взаимодействие

Клиент с сервером взаимодействуют через HTTPS, что позоляет безопасно передавать серверу пароль, а так же передавть в заголовках токен, содержащий другие данные пользователя.

### Регистрация и вход с систему.
#### Регистрация:
1. Пользователь отправляет на сервер логин с паролем.
2. Сервер генеририрует 2 соли AuthSalt и EncryptSalt.
3. Хеширует пароль с помощью AuthSalt и сохраняет в БД логин, хеш и обе соли.
4. Генерируется токен (JWT), который содержит ID пользователя.
5. Клиенту отправляеся JWT и EncryptSalt.
6. Клиент создает MasterKey из пароля и EncryptSalt, при помощи алгоритма Argon2id
7. JWT и MasterKey сохранияют в локальном хранилище клиента.

#### Вход в систему.

1. Пользователь отправляет на сервер логин с паролем.
2. Сервер хеширует пароль с помощью AuthSalt, и сравнивает его с хэшем из базы.
3. В случае успешного входа повторяются пункты 4-7 для регистрации.

Для авторизации клиент посылает на сервер JWT в заголоке. Токен подписан приватным ключом сервера. Сервер проверяет подпись и время жизни токена, подом находи пользователя по ID из токена.

### Шифрования данных.
Шифрование и расшифровка данных происходит на клиенте.
Для шифрования данных используется алгоритм AES-256-GCM.

#### Шифрование
1. Для каждого секрета генерирется блочный симметричный ключ DEK (Data Encryption Key).
2. Данные шифруются с помощью DEK
3. DEK шифруется ключом MasterKey используя AES-256-GCM.
4. Зашифрованные данные и зашифрованный DEK отправляются на сервер.

#### Расшифровка
Сервер отдает клиенту зашированные данные и ключ. Клиент расшировывает ключ с помошью мастер-ключа. Получившимся ключом расшифровывает данные.

MasterKey никогда не покидает клиент, он генерируется каждый раз при регистрации и входе в систему.

